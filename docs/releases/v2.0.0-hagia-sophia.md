# v2.0.0 Hagia Sophia

Released: 2026-02-14

## Summary

Hagia Sophia marks the first major release of Codev since 1.0. Named after the architectural masterpiece in Istanbul — a building that has endured for 1,500 years by continuously reinventing itself while keeping its foundations solid — v2.0.0 brings a complete rearchitecture of the terminal system, Tower server decomposition, cloud connectivity, and a mobile-friendly dashboard. Like the great dome of Hagia Sophia, the new Shellper session manager provides a self-supporting structure that doesn't rely on external tools.

## Highlights

- **Shellper**: Custom terminal session manager replaces tmux entirely
- **Tower Cloud Connect**: Register your Tower with codevos.ai from the web UI
- **Tower Server Decomposition**: Monolithic handler split into focused modules
- **Mobile-Ready Dashboard**: Full terminal access from phone and tablet
- **Porch Protocol Orchestrator**: State-machine-driven protocol execution with gates

## New Features

### Terminal Architecture (Specs 0081, 0094, 0104, 0106)
- **Shellper session manager**: Custom PTY manager replaces tmux — no external dependencies
- **Web terminal access**: Full terminal in the browser with xterm.js
- **Session persistence**: Reconnect to running sessions with output replay
- **Mobile compaction**: Touch-friendly virtual modifier keys, paste support
- **Renamed from Shepherd to Shellper** (shell + helper) for clarity

### Tower Server (Specs 0085, 0090, 0097, 0098, 0099, 0105, 0107)
- **Single daemon architecture**: One Tower process manages all projects
- **Server decomposition**: Monolithic handler split into tower-routes, tower-instances, tower-terminals, tower-tunnel, tower-utils, tower-websocket
- **Cloud tunnel client**: Secure WebSocket tunnel to codevos.ai
- **Cloud Connect UI**: Register/disconnect from Tower homepage with OAuth flow
- **Port registry removal**: Simplified networking, no more port conflicts
- **Codebase hygiene**: Dead code removal, consistent patterns

### Dashboard (Specs 0085, 0092, 0101)
- **Full rewrite**: React dashboard with file browser, terminal tabs, project management
- **Clickable file paths**: Terminal output file paths open in the file browser
- **Terminal file links**: Click paths in terminal output to view files
- **Image paste support**: Paste images directly into dashboard terminals

### Protocol & Orchestration (Specs 0083, 0095, 0100, 0102, 0103)
- **Porch protocol orchestrator**: State machine drives SPIR, TICK, and BUGFIX protocols
- **Gate notifications**: Desktop notifications when builders reach approval gates
- **Protocol-agnostic spawn**: `af spawn` works with any protocol
- **Porch worktree awareness**: Correct CWD handling in builder worktrees
- **Claude Agent SDK consultation**: `consult` uses Claude's agent SDK

### CLI Improvements
- `af tower connect` / `af tower disconnect` (renamed from register/deregister, aliases preserved)
- `af spawn --resume` to resume existing porch state
- `af attach` command for connecting to builder terminals
- Smart connect: reconnects without dialog when already registered

## Bug Fixes

Over 30 bug fixes including:
- Terminal scrollback history preserved on reconnect (#247)
- Dashboard 404s when accessed via cloud tunnel (#222)
- Terminal garbled output from concurrent writes (#205)
- Copy-paste text rendering in dashboard (#203)
- Zombie builder tab removal (#199)
- Consult diff truncation crashes (#240)
- Tower auto-reconnect to cloud on config change (#242)
- Architect auto-restart on exit (#213)
- Review loop on false positives (#245)
- Stale temp directory projects in Tower UI (#202)

## Infrastructure

- **CI**: 4-job pipeline — unit tests, Tower integration, CLI integration, package verification
- **E2E tests**: Playwright-based browser testing for Tower and dashboard
- **Test stability**: Fixed flaky E2E tests (temp directory filtering), vitest worker crash workaround

## Breaking Changes

- **tmux no longer required**: Shellper handles all terminal sessions natively
- **Single Tower port**: All projects served from port 4100 (no per-project ports)
- **Dashboard rewrite**: Old dashboard HTML replaced with React SPA

## Migration Notes

Upgrade with:

```bash
npm install -g @cluesmith/codev@2.0.0
af tower stop && af tower start
```

The first Tower start after upgrade will migrate the SQLite database automatically (v6/v7 migrations drop tmux columns, add shellper fields).
