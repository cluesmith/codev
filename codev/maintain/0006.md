# Maintenance Run 0006

## Metadata
- **Date**: 2026-02-07
- **Base Commit**: b8de08e (from run 0005)
- **Current HEAD**: d356b0e
- **Scope**: full
- **Commits since last run**: ~337

## Dead Code Identified

| File | Item | Reason |
|------|------|--------|
| `packages/codev/src/agent-farm/hq-connector.ts:429` | `stopHQConnector()` | Exported but never imported anywhere. `initHQConnector()` and `isHQEnabled()` are used. |
| `packages/codev/src/agent-farm/commands/start.ts:39` | `isPortAvailable()` | Exported but only imported by test file. Production code uses local copy in `shell.ts:121`. |
| `packages/codev/src/agent-farm/commands/start.ts:361-612` | `startLegacy()` + `startDashboard()` | References deleted `dashboard-server.ts`. Marked "kept for reference during migration — will be removed in Phase 4" but Phase 4 is complete (commit f7ddaf8). |
| `packages/codev/src/agent-farm/servers/tower-server.ts:1331` | `getProcessOnPort()` | Defined but never called anywhere in the codebase. |

## Unused Dependencies

| Package | Location | Reason |
|---------|----------|--------|
| `http-proxy` | packages/codev/package.json (dependency) | Zero imports in src/. Was likely used by old dashboard proxy, replaced by tower. |
| `@types/http-proxy` | packages/codev/package.json (devDependency) | Types for unused http-proxy. |
| `qrcode-terminal` | packages/codev/package.json (dependency) | Zero imports in src/. QR functionality may have been descoped or reimplemented. |
| `@types/qrcode-terminal` | packages/codev/package.json (devDependency) | Types for unused qrcode-terminal. |

## Stale Documentation

| Document | Issue |
|----------|-------|
| `codev/resources/arch.md:148` | "Dashboard Server" listed as key component — should reference Tower instead. |
| `codev/resources/arch.md:537` | Directory tree comment says "served by dashboard-server" — should say tower-server. |
| `codev/resources/arch.md:591` | Code example references `dashboard-server.ts` retry loop — file no longer exists. |
| `codev/resources/arch.md:981` | Directory tree lists `dashboard-server.ts` — file was deleted in Spec 0090 Phase 4. |
| `tests/e2e/dashboard.bats` | ~20 test assertions grep for `dashboard-server.js` in dist/ (lines 98-115, 258-325) — file no longer built. Entire file needs audit. |

## Recommended Actions

1. Remove `http-proxy`, `@types/http-proxy`, `qrcode-terminal`, `@types/qrcode-terminal` from package.json
2. Remove or unexport `stopHQConnector()` from hq-connector.ts
3. Remove `isPortAvailable()` export from start.ts (keep if tests still need it, or delete and update test)
4. Remove `startLegacy()` and `startDashboard()` from start.ts (Phase 4 migration complete)
5. Remove `getProcessOnPort()` from tower-server.ts
6. Fix all 4 stale `dashboard-server` references in arch.md (lines 148, 537, 591, 981)
7. Audit and fix `tests/e2e/dashboard.bats` — ~20 assertions reference deleted `dashboard-server.js`

## Consultation Log

### Iteration 1
- **Gemini**: APPROVE — confirmed all findings, no false positives
- **Codex**: REQUEST_CHANGES — found missed items: `startDashboard()`/`startLegacy()` dead code in start.ts, additional arch.md stale refs, dashboard.bats stale tests
- **Claude**: REQUEST_CHANGES — found missed items: `isPortAvailable()` dead export in start.ts, additional arch.md refs at lines 537 and 591
- **Action**: Updated report with all reviewer findings

### Iteration 2
- **Gemini**: FAILED (API error)
- **Codex**: FAILED (API error)
- **Claude**: APPROVE — confirmed all findings, corrected `isPortAvailable()` assessment (still valid as dead export, not called by `startRemote()`), found new dead code: `getProcessOnPort()` in tower-server.ts:1331, expanded dashboard.bats scope to ~20 assertions
- **Action**: Updated report with final findings. Accepting with 1/3 reviewers (2 API failures). Proceeding to Clean phase.
